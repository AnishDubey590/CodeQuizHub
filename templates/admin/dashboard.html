{# File: CodeQuizHub/templates/admin/dashboard.html #}
{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{{ title }}</h1>
        <span class="text-muted">Welcome, {{ current_user.username }}!</span>
    </div>

    {# Display Flash Messages - Already in base.html, but can be here too if base changes #}
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="row">
        <div class="col-md-8">
            <h4>Pending Organization Approvals</h4>
            {% if pending_orgs %}
                <ul class="list-group">
                    {% for org in pending_orgs %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{ org.name }}</strong><br>
                            <small class="text-muted">Requested: {{ org.requested_at.strftime('%Y-%m-%d %H:%M') if org.requested_at else 'N/A' }}</small>
                            {# Add Org Admin User info if available: org.admin_user.email #}
                        </div>
                        <div>
                            {# Ensure these routes exist and your forms are set up for POST #}
                            <form action="{{ url_for('admin.approve_organization', org_id=org.id) }}" method="POST" class="d-inline">
                                {{ csrf_token() }} {# If your POST routes are CSRF protected, which they should be #}
                                <button type="submit" class="btn btn-success btn-sm me-1">Approve</button>
                            </form>
                            <form action="{{ url_for('admin.reject_organization', org_id=org.id) }}" method="POST" class="d-inline">
                                {{ csrf_token() }}
                                <button type="submit" class="btn btn-danger btn-sm">Reject</button>
                            </form>
                            {# Add a link to view org details if you have such a route #}
                            <!-- <a href="{{ url_for('admin.view_organization_details', org_id=org.id) }}" class="btn btn-info btn-sm ms-1">Details</a> -->
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No organizations are currently pending approval.</p>
            {% endif %}
            <div class="mt-3">
                 <a href="{{ url_for('admin.view_organizations') }}" class="btn btn-outline-primary">View All Organizations</a>
            </div>
        </div>

        <div class="col-md-4">
            <h4>Site Management</h4>
            <div class="list-group">
                <a href="{{ url_for('admin.view_users') }}" class="list-group-item list-group-item-action">Manage Users</a>
                <!-- Add links to other admin sections like site settings, content management etc. -->
                <!-- <a href="#" class="list-group-item list-group-item-action disabled">Site Settings</a> -->
            </div>

            <h4 class="mt-4">Recent User Registrations</h4>
            {% if recent_users_creds %}
                <ul class="list-group">
                    {% for creds in recent_users_creds %}
                        <li class="list-group-item">
                            {{ creds.username }} ({{ creds.role.value }})
                            {% if creds.user and creds.user.email %}- {{ creds.user.email }}{% endif %}<br>
                            <small class="text-muted">Joined: {{ creds.created_at.strftime('%Y-%m-%d %H:%M') if creds.created_at else 'N/A' }}</small>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No recent user registrations.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}